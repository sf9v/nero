package gen

import (
	"bytes"
	"text/template"

	"github.com/sf9v/nero"
	"github.com/sf9v/nero/sort"
)

func newSortsFile(schema *nero.Schema) (*bytes.Buffer, error) {
	v := struct {
		Directions []sort.Direction
		Schema     *nero.Schema
	}{
		Directions: []sort.Direction{
			sort.Asc, sort.Desc,
		},
		Schema: schema,
	}

	tmpl, err := template.New("sorts.tmpl").Parse(sortTmpl)
	if err != nil {
		return nil, err
	}

	buf := new(bytes.Buffer)
	err = tmpl.Execute(buf, v)
	if err != nil {
		return nil, err
	}

	return buf, nil
}

const sortTmpl = `
// Code generated by nero, DO NOT EDIT.
package {{.Schema.PkgName}}

import (
	"github.com/sf9v/nero/sort"
)

// SortFunc is a sort function
type SortFunc func(*sort.Sorts)

{{range $direction := .Directions}}
// {{$direction.String}} sorts in {{$direction.Desc}} order
func {{$direction.String}}(col Column) SortFunc {
	return func(s *sort.Sorts) {
		s.Add(&sort.Sort{
			Col: col.String(),
			Direction: sort.{{$direction.String}},
		})
	}
}
{{end}}
`
